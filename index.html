<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aquamarin Delivery</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
import express from 'express';
import axios from 'axios';
import cors from 'cors';

const app = express();
app.use(cors());
app.use(express.json());

const BOT_TOKEN = process.env.BOT_TOKEN;         // Ñ‚Ð¾ÐºÐµÐ½ Ð±Ð¾Ñ‚Ð° Ð¸Ð· BotFather
const ADMIN_CHAT_ID = process.env.ADMIN_CHAT_ID; // Ñ‚Ð²Ð¾Ð¹ chat_id
const PORT = process.env.PORT || 3000;

// --- Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð° ---
app.get('/health', (req, res) => res.send({ ok: true }));

// --- Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð¸Ð· Mini App ---
app.post('/order', async (req, res) => {
  const { name, address, bottles } = req.body;
  if (!name || !address || !bottles) return res.status(400).send({ error: 'missing fields' });

  const text = `ðŸ§¾ ÐÐ¾Ð²Ñ‹Ð¹ Ð·Ð°ÐºÐ°Ð·:\nðŸ‘¤ ${name}\nðŸ“ ${address}\nðŸ’§ Ð‘ÑƒÑ‚Ñ‹Ð»ÐµÐ¹: ${bottles}`;

  try {
    if (BOT_TOKEN && ADMIN_CHAT_ID) {
      await axios.post(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        chat_id: ADMIN_CHAT_ID,
        text
      });
    }
    res.send({ ok: true });
  } catch (err) {
    console.error(err?.response?.data || err.message);
    res.status(500).send({ error: 'failed to send' });
  }
});

// --- webhook Ð´Ð»Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ ---
app.post('/webhook', async (req, res) => {
  const message = req.body.message;
  if (!message) return res.sendStatus(200);

  const chat_id = message.chat.id;
  const text = message.text;

  // ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¿Ñ€Ð¸ /start
  if (text === '/start') {
    const keyboard = {
      reply_markup: {
        inline_keyboard: [
          [
            { text: 'Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·', web_app: { url: 'https://aquamini-frontend.vercel.app' } }
          ]
        ]
      }
    };

    await axios.post(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
      chat_id,
      text: 'ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Aquamarine. Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ Ð·Ð°ÐºÐ°Ð· Ð²Ð¾Ð´Ñ‹ Ð¿Ñ€ÑÐ¼Ð¾ Ð¸Ð· Ð±Ð¾Ñ‚Ð°:',
      ...keyboard
    });
  }

  res.sendStatus(200);
});

app.listen(PORT, () => console.log('Server listening on', PORT));
